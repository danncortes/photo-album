<div
    class="page page-template--{{
        page().template
    }} shadow-lg shadow-gray-400 box-border grid bg-white flex"
    #pageExportDiv
    [style.aspect-ratio]="proportion() / 1"
    [style.gap]="gap()"
    [style.padding]="padding()"
>
    @for (photo of page().photos; track $index) {
        <app-photo
            [photoIndex]="$index"
            [photo]="photo"
            [pageIndex]="pageIndex()"
            [pagesPhotosLength]="page().photos.length"
            [borderRadius]="photoBorderRadius()"
        />
    }
    @if (pageSection(); as pageSections) {
        <div
            class="section-overlay"
            [style.padding]="getSectionMargin(pageSections.config.margin)"
            [class.section-overlay--top]="
                pageSections.config.position === 'top'
            "
            [class.section-overlay--bottom]="
                pageSections.config.position === 'bottom'
            "
            [class.section-overlay--lateral]="
                pageSections.config.position === 'lateral'
            "
            [class.section-overlay--right]="
                pageSections.config.position === 'lateral' &&
                pageIndex() % 2 !== 0
            "
            [class.section-overlay--left]="
                pageSections.config.position === 'lateral' &&
                pageIndex() % 2 === 0
            "
        >
            <div
                class="section-label"
                [style.padding]="getSectionPadding(pageSections.config)"
                [style.background-color]="pageSections.section.color"
                [style.border-radius]="
                    getSectionBorderRadius(pageSections.config.borderRadius)
                "
                [style.font-size]="
                    getSectionFontSize(pageSections.config.fontSize)
                "
            >
                <span class="section-name">{{
                    pageSections.section.name
                }}</span>
                @if (pageSections.subsection) {
                    <span class="subsection-name">{{
                        pageSections.subsection.name
                    }}</span>
                }
            </div>
        </div>
    }
</div>
<div class="page-controls flex justify-between">
    <div class="text-gray-500">
        {{ pageIndex() + 1 }}
    </div>
    <div class="flex gap-3 page-controls__right">
        <button class="" cdkOverlayOrigin [cdkMenuTriggerFor]="menu">
            <app-icon name="cog-6-tooth" [size]="iconSize" />
        </button>
        <button
            class=""
            (click)="downloadPage()"
            [disabled]="isPageDownloading()"
            title="Download Page"
        >
            @if (isPageDownloading()) {
                <span class="loading loading-xs loading-spinner"></span>
            } @else {
                <app-icon name="arrow-down-tray" [size]="iconSize" />
            }
        </button>
        <button class="" (click)="openTemplateDialog()">
            <app-icon name="table-cells" [size]="iconSize" />
        </button>
        <button class="" (click)="openMovePageDialog()" title="Move page">
            <app-icon name="arrows-right-left" [size]="iconSize" />
        </button>
        <div class="page-controls__shift-options flex gap-2">
            @for (option of shiftOptions; track $index) {
                <button
                    class=""
                    (click)="shiftPagePosition(option)"
                    [disabled]="isShiftPageDisabled(option, pageIndex())"
                >
                    @if (option === -1) {
                        <app-icon
                            name="arrow-left-on-rectangle"
                            [size]="iconSize"
                        />
                    } @else {
                        <app-icon
                            name="arrow-right-on-rectangle"
                            [size]="iconSize"
                        />
                    }
                </button>
            }
        </div>
        <button class="" (click)="removePage()">
            <app-icon name="trash" [size]="iconSize" />
        </button>
    </div>
</div>
<ng-template #menu>
    <div cdkMenu class="options-menu">
        <app-style-settings
            [pageIndex]="pageIndex()"
            (closeMenu)="closeSettingsMenu()"
        />
    </div>
</ng-template>
